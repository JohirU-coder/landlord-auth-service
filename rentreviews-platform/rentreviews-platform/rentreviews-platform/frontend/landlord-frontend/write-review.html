<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Write a Review - RentReviews</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .rating-stars {
            display: flex;
            gap: 4px;
        }
        
        .star {
            font-size: 1.5rem;
            color: #d1d5db;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .star:hover,
        .star.active {
            color: #fbbf24;
        }
        
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .contact-info-input {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .contact-info-input.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-50 min-h-screen">
    
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 w-8 h-8 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">⭐</span>
                        </div>
                        <span class="ml-3 text-xl font-bold text-gray-900">RentReviews</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="window.location.href='./dashboard.html'" class="text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium">
                        Dashboard
                    </button>
                    <button onclick="window.location.href='./search.html'" class="text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium">
                        Search
                    </button>
                    <button id="logoutBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        Sign Out
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 py-12">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-white mb-4">
                    Write a Review
                </h1>
                <p class="text-xl text-indigo-100">
                    Share your rental experience to help other renters make informed decisions
                </p>
            </div>
        </div>
    </div>

    <!-- Review Form -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Property Selection -->
        <div class="form-section">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Select Property</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Property Address</label>
                    <input type="text" id="propertyAddress" placeholder="Enter the property address" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                        <input type="text" id="propertyCity" placeholder="City" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                        <input type="text" id="propertyState" placeholder="State" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Zip Code</label>
                        <input type="text" id="propertyZip" placeholder="Zip Code" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>
        </div>

        <!-- Landlord Information -->
        <div class="form-section">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Landlord Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Landlord/Property Manager Name</label>
                    <input type="text" id="landlordName" placeholder="Full name or company name" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Contact Method</label>
                    <select id="contactMethod" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Select contact method</option>
                        <option value="phone">Phone</option>
                        <option value="email">Email</option>
                        <option value="text">Text/SMS</option>
                        <option value="app">Property Management App</option>
                        <option value="in-person">In Person</option>
                    </select>
                </div>
            </div>
            
            <!-- Dynamic Contact Info Field -->
            <div class="mt-4">
                <div id="phone-input" class="contact-info-input">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" id="phoneNumber" placeholder="(555) 123-4567" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div id="email-input" class="contact-info-input">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="emailAddress" placeholder="landlord@example.com" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div id="text-input" class="contact-info-input">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Text/SMS Number</label>
                    <input type="tel" id="textNumber" placeholder="(555) 123-4567" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div id="app-input" class="contact-info-input">
                    <label class="block text-sm font-medium text-gray-700 mb-2">App Name</label>
                    <input type="text" id="appName" placeholder="e.g., AppFolio, Buildium" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div id="in-person-input" class="contact-info-input">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Office Location</label>
                    <input type="text" id="officeLocation" placeholder="Office address or location" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
            </div>
        </div>

        <!-- Ratings -->
        <div class="form-section">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Rate Your Experience</h2>
            <div class="space-y-6">
                
                <!-- Overall Rating -->
                <div>
                    <label class="block text-lg font-medium text-gray-900 mb-3">Overall Rating</label>
                    <div class="rating-stars" data-rating="overall">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                </div>

                <!-- Communication -->
                <div>
                    <label class="block text-lg font-medium text-gray-900 mb-3">Communication</label>
                    <p class="text-sm text-gray-600 mb-2">How responsive and clear was the landlord?</p>
                    <div class="rating-stars" data-rating="communication">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                </div>

                <!-- Maintenance -->
                <div>
                    <label class="block text-lg font-medium text-gray-900 mb-3">Maintenance & Repairs</label>
                    <p class="text-sm text-gray-600 mb-2">How quickly were issues addressed?</p>
                    <div class="rating-stars" data-rating="maintenance">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                </div>

                <!-- Property Condition -->
                <div>
                    <label class="block text-lg font-medium text-gray-900 mb-3">Property Condition</label>
                    <p class="text-sm text-gray-600 mb-2">Overall state of the property and cleanliness</p>
                    <div class="rating-stars" data-rating="condition">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                </div>

                <!-- Value -->
                <div>
                    <label class="block text-lg font-medium text-gray-900 mb-3">Value for Money</label>
                    <p class="text-sm text-gray-600 mb-2">Was the rent fair for what you got?</p>
                    <div class="rating-stars" data-rating="value">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Written Review -->
        <div class="form-section">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Tell Your Story</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Review Title</label>
                    <input type="text" id="reviewTitle" placeholder="Summarize your experience in a few words" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Detailed Review</label>
                    <textarea id="reviewText" rows="6" placeholder="Share your experience living at this property. What should other renters know?" 
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    <p class="text-sm text-gray-500 mt-2">Minimum 50 characters. Be honest and helpful!</p>
                </div>
            </div>
        </div>

        <!-- Rental Details -->
        <div class="form-section">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Rental Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Move-in Date</label>
                    <input type="date" id="moveInDate" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Move-out Date (if applicable)</label>
                    <input type="date" id="moveOutDate" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Rent</label>
                    <input type="number" id="monthlyRent" placeholder="2500" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="flex items-center space-x-6 pt-8">
                    <label class="flex items-center">
                        <input type="checkbox" id="wouldRecommend" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="ml-2 text-sm text-gray-700">Would recommend to others</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="anonymous" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="ml-2 text-sm text-gray-700">Post anonymously</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
            <button id="submitReview" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg">
                📝 Submit Review
            </button>
            <p class="text-sm text-gray-500 mt-4">
                By submitting this review, you agree to our <a href="#" class="text-indigo-600 hover:text-indigo-800">Terms of Service</a> and confirm that this review is based on your genuine experience.
            </p>
        </div>
    </div>

    <script>
        // Contact Method Dynamic Input Functionality
        document.getElementById('contactMethod').addEventListener('change', function() {
            // Hide all contact info inputs
            const contactInputs = document.querySelectorAll('.contact-info-input');
            contactInputs.forEach(input => {
                input.classList.remove('active');
            });

            // Show the selected input
            const selectedMethod = this.value;
            if (selectedMethod) {
                const targetInput = document.getElementById(selectedMethod + '-input');
                if (targetInput) {
                    targetInput.classList.add('active');
                }
            }
        });

        // Helper function to get contact info based on selected method
        function getContactInfo() {
            const contactMethod = document.getElementById('contactMethod').value;
            switch(contactMethod) {
                case 'phone':
                    return document.getElementById('phoneNumber').value;
                case 'email':
                    return document.getElementById('emailAddress').value;
                case 'text':
                    return document.getElementById('textNumber').value;
                case 'app':
                    return document.getElementById('appName').value;
                case 'in-person':
                    return document.getElementById('officeLocation').value;
                default:
                    return '';
            }
        }

        // Get property data from URL parameters
        function getPropertyFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const propertyParam = urlParams.get('property');
            
            if (propertyParam) {
                try {
                    return JSON.parse(decodeURIComponent(propertyParam));
                } catch (error) {
                    console.error('Error parsing property data:', error);
                    return null;
                }
            }
            return null;
        }

        // Pre-fill form with property data
        function prefillPropertyData() {
            const propertyData = getPropertyFromURL();
            
            if (propertyData) {
                document.getElementById('propertyAddress').value = propertyData.address || '';
                document.getElementById('propertyCity').value = propertyData.city || '';
                document.getElementById('propertyState').value = propertyData.state || '';
                document.getElementById('propertyZip').value = propertyData.zip_code || '';
                document.getElementById('landlordName').value = propertyData.landlord_name || '';
                
                // Show a helpful message
                const header = document.querySelector('h1');
                if (header && propertyData.address) {
                    header.innerHTML = `Write a Review<br><span class="text-lg font-normal text-indigo-200">for ${propertyData.address}</span>`;
                }
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            prefillPropertyData();
        });

        // Star rating functionality
        const ratingGroups = document.querySelectorAll('.rating-stars');
        const ratings = {};

        ratingGroups.forEach(group => {
            const ratingType = group.dataset.rating;
            const stars = group.querySelectorAll('.star');
            
            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    const rating = index + 1;
                    ratings[ratingType] = rating;
                    
                    // Update visual state
                    stars.forEach((s, i) => {
                        if (i < rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
                
                star.addEventListener('mouseenter', () => {
                    stars.forEach((s, i) => {
                        if (i <= index) {
                            s.style.color = '#fbbf24';
                        } else {
                            s.style.color = '#d1d5db';
                        }
                    });
                });
            });
            
            group.addEventListener('mouseleave', () => {
                stars.forEach((s, i) => {
                    if (ratings[ratingType] && i < ratings[ratingType]) {
                        s.style.color = '#fbbf24';
                    } else {
                        s.style.color = '#d1d5db';
                    }
                });
            });
        });

        // Enhanced form submission with property connection
        document.getElementById('submitReview').addEventListener('click', async () => {
            const propertyData = getPropertyFromURL();
            
            // Get form data
            const formData = {
                property: {
                    id: propertyData?.id || null,
                    address: document.getElementById('propertyAddress').value,
                    city: document.getElementById('propertyCity').value,
                    state: document.getElementById('propertyState').value,
                    zip: document.getElementById('propertyZip').value
                },
                landlord: {
                    name: document.getElementById('landlordName').value,
                    contactMethod: document.getElementById('contactMethod').value,
                    contactInfo: getContactInfo() // NEW: Now captures the actual contact details
                },
                ratings: ratings,
                review: {
                    title: document.getElementById('reviewTitle').value,
                    text: document.getElementById('reviewText').value
                },
                rental: {
                    moveInDate: document.getElementById('moveInDate').value,
                    moveOutDate: document.getElementById('moveOutDate').value,
                    monthlyRent: document.getElementById('monthlyRent').value,
                    wouldRecommend: document.getElementById('wouldRecommend').checked,
                    anonymous: document.getElementById('anonymous').checked
                }
            };

            // Basic validation
            if (!formData.property.address || !formData.review.title || !formData.review.text) {
                alert('Please fill in all required fields (property address, review title, and review text).');
                return;
            }

            if (Object.keys(ratings).length === 0) {
                alert('Please provide at least an overall rating.');
                return;
            }

            // Enhanced success message
            const propertyAddress = formData.property.address;
            alert(`Thank you for your review of ${propertyAddress}! Your review helps other renters make informed decisions. It will be published after verification.`);
            
            console.log('Complete review data:', formData); // For debugging
            
            // Redirect back to search or dashboard
            if (propertyData?.id) {
                // If we came from a specific property, go back to search
                window.location.href = './search.html';
            } else {
                // Otherwise go to dashboard
                window.location.href = './dashboard.html';
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('rentreviews_token');
            localStorage.removeItem('rentreviews_user');
            window.location.href = './auth.html';
        });
    </script>
</body>
</html>